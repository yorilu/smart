function karma(e,t){argv.browsers&&t.push("--browsers="+argv.browsers.trim()),argv.reporters&&t.push("--reporters="+argv.reporters.trim()),cp.spawn("node",["./node_modules/karma/bin/karma","start"].concat(t),{stdio:"inherit"}).on("exit",function(t){if(t)return e("Karma test(s) failed. Exit code: "+t);e()})}function pad(e){return e<10?"0"+e:e}function protractor(e,t){cp.spawn("protractor",t,{stdio:"inherit"}).on("exit",function(t){connectServer&&connectServer.close();if(t)return e("Protector test(s) failed. Exit code: "+t);e()})}function sauceConnect(e){require("sauce-connect-launcher")({username:process.env.SAUCE_USER,accessKey:process.env.SAUCE_KEY,verbose:!0,tunnelIdentifier:process.env.TRAVIS_BUILD_NUMBER},function(t,n){if(t)return e("Failed to launch sauce connect!");sauceInstance=n,e()})}function sauceDisconnect(e){if(sauceInstance)return sauceInstance.close(e);e()}function notContains(e){function t(e,t){var n="[^A-Za-z0-9$_]",r=new RegExp("(^|"+n+")("+t+")"+n+"*\\(","gm"),i=r.exec(e);return i!==null?i.index+i[1].length:-1}return e=e||[],through(function(n){var r,i=n.contents.toString();e.forEach(function(e){var s=t(i,e);s!==-1&&(r=r||n.path+" contains "+e+" on line "+i.substring(0,s,e).split("\n").length+"!")});if(r)throw new Error(r);this.emit("data",n)})}var _=require("lodash"),buildConfig=require("./config/build.config.js"),changelog=require("conventional-changelog"),connect=require("connect"),dgeni=require("dgeni"),http=require("http"),cp=require("child_process"),gulp=require("gulp"),pkg=require("./package.json"),semver=require("semver"),through=require("through"),argv=require("minimist")(process.argv.slice(2)),concat=require("gulp-concat"),gulpif=require("gulp-if"),header=require("gulp-header"),jshint=require("gulp-jshint"),minifyCss=require("gulp-minify-css"),rename=require("gulp-rename"),sass=require("gulp-sass"),stripDebug=require("gulp-strip-debug"),template=require("gulp-template"),uglify=require("gulp-uglify"),gutil=require("gulp-util"),banner=_.template(buildConfig.banner,{pkg:pkg}),IS_RELEASE_BUILD=!!argv.release;IS_RELEASE_BUILD&&gutil.log(gutil.colors.red("--release:"),"Building release version (minified, debugs stripped)..."),gulp.task("default",["build"]),gulp.task("build",["bundle","sass"]),gulp.task("docs",function(e){var t=argv["doc-version"];return t!="nightly"&&!semver.valid(t)?(console.log("Usage: gulp docs --doc-version=(nightly|versionName)"),process.exit(1)):(process.env.DOC_VERSION=t,dgeni("docs/docs.config.js").generateDocs().then(function(){gutil.log("Docs for",gutil.colors.cyan(t),"generated!")}))});var IS_WATCH=!1;gulp.task("watch",function(){IS_WATCH=!0,gulp.watch("js/**/*.js",["bundle"]),gulp.watch("scss/**/*.scss",["sass"])}),gulp.task("changelog",function(e){changelog({repository:pkg.repository.url,version:pkg.version},function(t,n){if(t)return e(t);require("fs").writeFileSync("CHANGELOG.md",n),e()})}),gulp.task("bundle",["scripts","scripts-ng","vendor","version"],function(){return IS_RELEASE_BUILD&&gulp.src(buildConfig.ionicBundleFiles.map(function(e){return e.replace(/.js$/,".min.js")})).pipe(header(buildConfig.bundleBanner)).pipe(concat("ionic.bundle.min.js")).pipe(gulp.dest(buildConfig.distJs)),gulp.src(buildConfig.ionicBundleFiles).pipe(header(buildConfig.bundleBanner)).pipe(concat("ionic.bundle.js")).pipe(gulp.dest(buildConfig.distJs))}),gulp.task("jshint",function(){return gulp.src(["js/**/*.js","test/**/*.js"]).pipe(jshint(".jshintrc")).pipe(jshint.reporter("jshint-stylish"))}),gulp.task("ddescribe-iit",function(){return gulp.src(["test/**/*.js","js/**/*.js"]).pipe(notContains(["ddescribe","iit","xit","xdescribe"]))}),gulp.task("vendor",function(){return gulp.src(buildConfig.vendorFiles,{cwd:"config/lib/",base:"config/lib/"}).pipe(gulp.dest(buildConfig.dist))}),gulp.task("scripts",function(){return gulp.src(buildConfig.ionicFiles).pipe(gulpif(IS_RELEASE_BUILD,stripDebug())).pipe(concat("ionic.js")).pipe(header(banner)).pipe(gulp.dest(buildConfig.distJs)).pipe(gulpif(IS_RELEASE_BUILD,uglify())).pipe(rename({extname:".min.js"})).pipe(header(banner)).pipe(gulp.dest(buildConfig.distJs))}),gulp.task("scripts-ng",function(){return gulp.src(buildConfig.angularIonicFiles).pipe(concat("ionic-angular.js")).pipe(header(banner)).pipe(gulp.dest(buildConfig.distJs)).pipe(gulpif(IS_RELEASE_BUILD,uglify())).pipe(rename({extname:".min.js"})).pipe(header(banner)).pipe(gulp.dest(buildConfig.distJs))}),gulp.task("sass",function(e){gulp.src("scss/ionic.scss").pipe(header(banner)).pipe(sass({onError:function(t){IS_WATCH?console.log(gutil.colors.red(t)):e(t)}})).pipe(concat("ionic.css")).pipe(header(banner)).pipe(gulp.dest(buildConfig.distCss)).pipe(gulpif(IS_RELEASE_BUILD,minifyCss({keepSpecialComments:0}))).pipe(rename({extname:".min.css"})).pipe(header(banner)).pipe(gulp.dest(buildConfig.distCss)).on("end",e)}),gulp.task("version",function(){var e=new Date,t=e.toISOString().substring(0,10),n=pad(e.getUTCHours())+":"+pad(e.getUTCMinutes())+":"+pad(e.getUTCSeconds());return gulp.src("config/version.template.json").pipe(template({pkg:pkg,date:t,time:n})).pipe(rename("version.json")).pipe(gulp.dest("dist"))}),gulp.task("sauce-connect",sauceConnect),gulp.task("cloudtest",["protractor-sauce"],function(e){sauceDisconnect(e)}),gulp.task("karma",function(e){return karma(e,["config/karma.conf.js","--single-run=true"])}),gulp.task("karma-watch",function(e){return karma(e,["config/karma.conf.js"])});var connectServer;gulp.task("connect-server",function(){var e=connect().use(connect.static(__dirname));connectServer=http.createServer(e).listen(8765)}),gulp.task("protractor",["connect-server"],function(e){return protractor(e,["config/protractor.conf.js"])}),gulp.task("protractor-sauce",["sauce-connect","connect-server"],function(e){return protractor(e,["config/protractor-sauce.conf.js"])});var sauceInstance