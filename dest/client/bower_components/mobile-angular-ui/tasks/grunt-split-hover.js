var cssParse,cssStringify,fs,parameterize,path,util;util=require("util"),parameterize=require("parameterize"),fs=require("fs"),path=require("path"),cssParse=require("css-parse"),cssStringify=require("css-stringify"),module.exports=function(e){return e.task.registerMultiTask("split-hover","Collect and remove :hover rules from css",function(){var t=this.data,n=e.file.expand({cwd:t.cwd||"."},t.src),r=t.dest;if(!r)throw new Error("config.dest not set");n.forEach(function(e){var n=t.basename||path.basename(e,path.extname(e)),i=path.resolve(t.cwd||".",e),s=path.resolve(r),o=fs.readFileSync(i).toString(),u=cssParse(o),a=u.stylesheet.rules||[],f={type:"stylesheet",stylesheet:{rules:[]}},l=f.stylesheet.rules;a.forEach(function(e){if(e.type==="rule"){var t=[];e.selectors=e.selectors.filter(function(e){var n=e.match(/\:hover/);return n?(t.push(e),!1):!0}),t.length&&l.push({type:"rule",selectors:t,declarations:e.declarations})}}),u.stylesheet.rules=u.stylesheet.rules.filter(function(e){return e.type!="rule"||!!e.selectors.length}),fs.writeFileSync(i,cssStringify(u)),fs.writeFileSync(s,cssStringify(f))})})}