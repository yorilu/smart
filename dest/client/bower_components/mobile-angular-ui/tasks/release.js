var exec,path,semver;exec=require("child_process").exec,path=require("path"),semver=require("semver"),module.exports=function(e){var t;t=function(t,n){var r;e.log.writeln("Executing: "+t.blue),r=exec(t,function(t,r,i){if(t){e.fail.warn(t),n(t);return}n(!1,r)}),r.stdout.pipe(process.stdout)},["prerelease"].forEach(function(n){return e.task.registerTask(n,"Commit and release a new version",function(){var r,i,s;return s=this.async(),r=e.option("msg"),r||(e.fail.warn("Commit message can't be blank"),s),i=null,t("git tag",function(e,o){var u,a,f;if(!e)return f=o.split("\n").filter(function(e){return semver.valid(e)}),a=f.sort(function(e,t){return semver.rcompare(e,t)}),u=a[0],i=semver.inc(u,n),console.log("Latest:",u),console.log("Next:",i),t("git add .",function(e,n){return e?s():t('git commit -m "'+r+'" -a',function(e,n){return e?s():t("git push",function(e,n){return e?s():t("git tag -a "+i+' -m "'+r+'"',function(e,n){return e?s():t("git push --tags",function(e,t){return s()})})})})})})})})}