(function(){var e=angular.module("mobile-angular-ui.core.sharedState",[]);e.factory("SharedState",["$rootScope","$parse",function(e,t){var n={},r={},i={},s={};return{initialize:function(t,o,u){u=u||{};var a=i[t]===undefined,f=u.defaultValue,l=u.exclusionGroup;i[t.$id]=i[t.$id]||[],i[t.$id].push(o),r[o]?a&&r[o].references++:(r[o]=angular.extend({},u,{references:1}),e.$broadcast("mobile-angular-ui.state.initialized."+o,f),f!==undefined&&this.setOne(o,f),l&&(s[l]=s[l]||{},s[l][o]=!0)),t.$on("$destroy",function(){var u=i[t.$id]||[];for(var a=0;a<u.length;a++){var f=r[u[a]];f.exclusionGroup&&(delete s[f.exclusionGroup][u[a]],Object.keys(s[f.exclusionGroup]).length===0&&delete s[f.exclusionGroup]),f.references--,f.references<=0&&(delete r[u[a]],delete n[u[a]],e.$broadcast("mobile-angular-ui.state.destroyed."+o))}delete i[t.$id]})},setOne:function(t,i){if(r[t]!==undefined){var s=n[t];return n[t]=i,s!=i&&e.$broadcast("mobile-angular-ui.state.changed."+t,i,s),i}console&&console.warn("Warning: Attempt to set uninitialized shared state:",t)},setMany:function(e){angular.forEach(e,function(e,t){this.setOne(t,e)},this)},set:function(e,t){angular.isObject(e)&&angular.isUndefined(t)?this.setMany(e):this.setOne(e,t)},turnOn:function(e){var t=r[e]&&r[e].exclusionGroup;if(t){var n=Object.keys(s[t]);for(var i=0;i<n.length;i++){var o=n[i];o!=e&&this.turnOff(o)}}return this.setOne(e,!0)},turnOff:function(e){return this.setOne(e,!1)},toggle:function(e){return this.get(e)?this.turnOff(e):this.turnOn(e)},get:function(e){return r[e]&&n[e]},isActive:function(e){return!!this.get(e)},active:function(e){return this.isActive(e)},isUndefined:function(e){return r[e]===undefined||this.get(e)===undefined},has:function(e){return r[e]!==undefined},referenceCount:function(e){var t=r[e];return t===undefined?undefined:t.references},equals:function(e,t){return this.get(e)===t},eq:function(e,t){return this.equals(e,t)},values:function(){return n}}}]);var t=function(e,t,n,r){n=n||"click tap",t.on(n,function(t){e.$apply(function(){r(e,{$event:t})})})};e.directive("uiState",["SharedState","$parse",function(e,t){return{restrict:"EA",priority:601,link:function(t,n,r){var i=r.uiState||r.id,s=r.uiDefault||r["default"],o=s?t.$eval(s):undefined;e.initialize(t,i,{defaultValue:o,exclusionGroup:r.uiExclusionGroup})}}}]),angular.forEach(["toggle","turnOn","turnOff","set"],function(n){var r="ui"+n[0].toUpperCase()+n.slice(1);e.directive(r,["$parse","SharedState",function(e,i){var s=i[n];return{restrict:"A",priority:1,compile:function(o,u){var a=n==="set"?e(u[r]):function(e){return u[r]};return function(e,n,r){var o=function(){var t=a(e);return s.call(i,t)};t(e,n,r.uiTriggers,o)}}}}])});var n=function(e){if(!e||e==="")return[];var t=e?e.trim().split(/ *, */):[],n=[];for(var r=0;r<t.length;r++){var i=t[r].split(/ *as */);if(i.length>2||i.length<1)throw new Error('Error parsing uiScopeContext="'+e+'"');n.push(i)}return n},r=function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r][0],s=t[r][1]||i;e[s]=n[i]}},i=function(e,t,i,s,o){var u=o(t[e]),a=n(t.uiScopeContext);return function(){var e;return a.length?(e=angular.extend({},s.values()),r(e,a,i)):e=s.values(),u(e)}};e.directive("uiIf",["$animate","SharedState","$parse",function(e,t,n){function r(e){var t=e[0],n=e[e.length-1],r=[t];do{t=t.nextSibling;if(!t)break;r.push(t)}while(t!==n);return angular.element(r)}return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(s,o,u,a,f){var l,c,h,p=i("uiIf",u,s,t,n);s.$watch(p,function(n){if(n)c||f(function(t,n){c=n,t[t.length++]=document.createComment(" end uiIf: "+u.uiIf+" "),l={clone:t},e.enter(t,o.parent(),o)});else{h&&(h.remove(),h=null),c&&(c.$destroy(),c=null);if(l){h=r(l.clone);var i=function(){h=null},s=e.leave(h,i);s&&s.then(i),l=null}}})}}}]),e.directive("uiHide",["$animate","SharedState","$parse",function(e,t,n){var r="ng-hide",s="ng-hide-animate";return{restrict:"A",multiElement:!0,link:function(o,u,a){var f=n(a.uiHide),l=i("uiHide",a,o,t,n);o.$watch(l,function(n){e[n?"addClass":"removeClass"](u,r,{tempClasses:s})})}}}]),e.directive("uiShow",["$animate","SharedState","$parse",function(e,t,n){var r="ng-hide",s="ng-hide-animate";return{restrict:"A",multiElement:!0,link:function(o,u,a){var f=n(a.uiShow),l=i("uiShow",a,o,t,n);o.$watch(l,function(n){e[n?"removeClass":"addClass"](u,r,{tempClasses:s})})}}}]),e.directive("uiClass",["SharedState","$parse",function(e,t){return{restrict:"A",link:function(n,r,s){var o=t(s.uiClass),u=i("uiClass",s,n,e,t);n.$watch(u,function(t){var n="",i="";angular.forEach(t,function(e,t){e?n+=" "+t:i+=" "+t,n.length&&r.addClass(n),i.length&&r.removeClass(i)})},!0)}}}]),e.run(["$rootScope","SharedState",function(e,t){e.Ui=t}])})()