!function(e){!function(e,t){function n(t,n,r,i){function s(t,n){var r=e.isObject(t)?t.name:t;return n?p[r]:c[r]}function o(e,t){if(t.name){var n=t.name.split(/\./);for("."===t.name.charAt(0)&&(n[0]=e.current.name);n.length;){var r=n.join(".");if(e.get(r,{relative:e.current}))return null;if(p[r])return p[r];n.pop()}}if(t.url){var i=[];for(var s in p){var o=p[s].urlMatcher;o&&o.exec(t.url)&&i.push(p[s])}for(var u=i.slice(0),a=i.length-1;a>=0;a--)for(var f=0;f<u.length;f++)i[a]===u[f].parentFutureState&&i.splice(a,1);return i[0]}}function u(e,t){d=!0;var n=e.get("$q");if(!t){var r=n.defer();return r.reject("No lazyState passed in "+t),r.promise}var i=n.when([]),s=t.parentFutureState;s&&p[s.name]&&(i=u(e,p[s.name]));var o=t.type,a=h[o];if(!a)throw Error("No state factory for futureState.type: "+(t&&t.type));return i.then(function(n){var r=e.invoke(a,a,{futureState:t});return r.then(function(e){return e&&n.push(e),n})})["finally"](function(){delete p[t.name]})}function a(e,n){var r=!1,i=["$rootScope","$urlRouter","$state",function(i,s,a){function l(){r=!0,s.sync(),r=!1}if(!m)return f().then(l),void (m=!0);var c=o(a,{url:n.path()});return c?void u(e,c).then(function(e){e.forEach(function(e){e&&(!a.get(e)||e.name&&!a.get(e.name))&&t.state(e)}),d=!1,l()},function(){d=!1,l()}):e.invoke(y)}];if(!d){var s=r?y:i;return e.invoke(s)}}var f,l=i,c=l.internalStates,h={},p={},d=!1,v=[],m=!1,g=this;this.addResolve=function(e){v.push(e)},this.stateFactory=function(e,t){h[e]=t},this.futureState=function(t){t.stateName&&(t.name=t.stateName),t.urlPrefix&&(t.url="^"+t.urlPrefix),p[t.name]=t;var n,i=t.name.split(/\./).slice(0,-1).join("."),o=s(t.parent||i);if(o)n=o.url||o.navigable.url;else if(""===i)n=r.compile("");else{var u=s(t.parent||i,!0);if(!u)throw new Error("Couldn't determine parent state of future state. FutureState:"+e.toJson(t));var a=u.urlMatcher.source.replace(/\*rest$/,"");n=r.compile(a),t.parentFutureState=u}t.url&&(t.urlMatcher="^"===t.url.charAt(0)?r.compile(t.url.substring(1)+"*rest"):n.concat(t.url+"*rest"))},this.get=function(){return e.extend({},p)};var y=["$log","$location",function(e,t){e.debug("Unable to map "+t.path())}];n.otherwise(a),n.otherwise=function(t){if(e.isString(t)){var r=t;t=function(){return r}}else if(!e.isFunction(t))throw new Error("'rule' must be a function");return y=["$injector","$location",t],n};var b={getResolvePromise:function(){return f()}};this.$get=["$injector","$state","$q","$rootScope","$urlRouter","$timeout","$log",function(n,r,i,s,a,l,c){function h(){if(s.$on("$stateNotFound",function(e,i,s,a){if(!d){c.debug("event, unfoundState, fromState, fromParams",e,i,s,a);var f=o(r,{name:i.to});if(f){e.preventDefault();var l=u(n,f);l.then(function(e){e.forEach(function(e){e&&(!r.get(e)||e.name&&!r.get(e.name))&&t.state(e)}),r.go(i.to,i.toParams),d=!1},function(e){console.log("failed to lazy load state ",e),r.go(s,a),d=!1})}}}),!f){var h=[];e.forEach(v,function(e){h.push(n.invoke(e))}),f=function(){return i.all(h)}}f().then(function(){l(function(){r.transition?r.transition.then(a.sync,a.sync):a.sync()})})}return h(),b.state=t.state,b.futureState=g.futureState,b.get=g.get,b}]}var r=e.module("ct.ui.router.extras.future",["ct.ui.router.extras.core"]);n.$inject=["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","uirextras_coreProvider"],r.provider("$futureState",n);var i={state:function(e){i.$rootScope&&i.$rootScope.$broadcast("$stateAdded",e)},itsNowRuntimeOhWhatAHappyDay:function(e){i.$rootScope=e},$rootScope:t};r.config(["$stateProvider",function(t){var n=t.state;t.state=function(){var r=n.apply(t,arguments),s=e.isObject(arguments[0])?arguments[0]:arguments[1];return i.state(s),r}}]),r.run(["$futureState",function(e,t){i.itsNowRuntimeOhWhatAHappyDay(t)}])}(e)}(angular)