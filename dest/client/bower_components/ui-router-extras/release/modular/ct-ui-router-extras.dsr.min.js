!function(e,t){function n(){r=t}var r;e.module("ct.ui.router.extras.dsr",["ct.ui.router.extras.core"]).config(["$provide",function(e){var t;e.decorator("$state",["$delegate","$q",function(e,i){return t=e.transitionTo,e.transitionTo=function(s,o,u){return u.ignoreDsr&&(r=u.ignoreDsr),t.apply(e,arguments).then(function(e){return n(),e},function(e){return n(),i.reject(e)})},e}])}]),e.module("ct.ui.router.extras.dsr").service("$deepStateRedirect",["$rootScope","$state","$injector",function(n,i,s){function o(e){var t=e.name;return h.hasOwnProperty(t)?h[t]:void a(t)}function u(t){var n=t.deepStateRedirect||t.dsr;if(!n)return{dsr:!1};var r={dsr:!0};return e.isFunction(n)?r.fn=n:e.isObject(n)&&(r=e.extend(r,n)),e.isString(r["default"])&&(r["default"]={state:r["default"]}),r.fn||(r.fn=["$dsr$",function(e){return e.redirect.state!=e.to.state}]),r}function a(e){var n=i.get(e);if(!n)return!1;var r=u(n);r.dsr&&(h[n.name]=p,c[e]===t&&(c[e]={}));var s=n.$$state&&n.$$state().parent;if(s){var o=a(s.self.name);o&&h[n.name]===t&&(h[n.name]=d)}return h[n.name]||!1}function f(n,r){r===!0&&(r=Object.keys(n)),(null===r||r===t)&&(r=[]);var i={};return e.forEach(r.sort(),function(e){i[e]=n[e]}),i}function l(t,n){function r(e){return e?e.toString():e}var i=f(t,n),s={};return e.forEach(i,function(e,t){s[t]=r(e)}),e.toJson(s)}var c={},h={},p="Redirect",d="AncestorRedirect";return n.$on("$stateChangeStart",function(t,n,a){var h=u(n);if(!r&&(o(n)===p||h["default"])){var d=l(a,h.params),v=c[n.name][d]||h["default"];if(v){var g={redirect:{state:v.state,params:v.params},to:{state:n.name,params:a}},y=s.invoke(h.fn,n,{$dsr$:g});if(y){y.state&&(v=y),t.preventDefault();var b=f(a,h.params);i.go(v.state,e.extend(b,v.params))}}}}),n.$on("$stateChangeSuccess",function(t,n,r){var s=o(n);if(s){var a=n.name;e.forEach(c,function(t,n){var s=u(i.get(n)),o=l(r,s.params);(a==n||-1!=a.indexOf(n+"."))&&(c[n][o]={state:a,params:e.copy(r)})})}}),{reset:function(t,n){if(t){var r=i.get(t);if(!r)throw new Error("Unknown state: "+t);if(c[r.name])if(n){var s=l(n,u(r).params);delete c[r.name][s]}else c[r.name]={}}else e.forEach(c,function(e,t){c[t]={}})}}}]),e.module("ct.ui.router.extras.dsr").run(["$deepStateRedirect",function(){}])}(angular)