/**

 * UI-Router Extras: Sticky states, Future States, Deep State Redirect, Transition promise
 * Monolithic build (all modules)
 * @version 0.0.13
 * @link http://christopherthielen.github.io/ui-router-extras/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

(function(e,t){function p(e,t){var n=[];for(var r in e.path){if(e.path[r]!==t.path[r])break;n.push(e.path[r])}return n}function d(t){if(Object.keys)return Object.keys(t);var n=[];return e.forEach(t,function(e,t){n.push(t)}),n}function v(e,t){var n=[];for(var r in e)(!t||t.indexOf(r)===-1)&&n.push(r);return n}function m(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,r=Number(arguments[2])||0;r=r<0?Math.ceil(r):Math.floor(r),r<0&&(r+=n);for(;r<n;r++)if(r in e&&e[r]===t)return r;return-1}function g(e,t,n,r){var i=p(n,r),s,o={},f=[];for(var l in i){if(!i[l].params)continue;s=a(i[l].params)?i[l].params:d(i[l].params);if(!s.length)continue;for(var c in s){if(m(f,s[c])>=0)continue;f.push(s[c]),o[s[c]]=e[s[c]]}}return u({},o,t)}function y(e,t){return u(new(u(function(){},{prototype:e})),t)}function b(e){i.push(e)}function E(){w=t}function x(t,n){var r=n,i=r.inheritParams,s=r.protoKeys,o=r.map,u={},a={},f,l=!1;this.registerStickyState=function(e){a[e.name]=e},this.enableDebug=this.debugMode=function(t){return e.isDefined(t)&&(l=t),l},this.$get=["$rootScope","$state","$stateParams","$injector","$log",function(t,n,r,a,f){function c(){var t={};return e.forEach(u,function(e,n){var r=h(e);for(var i=0;i<r.length;i++){var s=r[i].parent;t[s.name]=t[s.name]||[],t[s.name].push(e)}t[""]&&(t.__inactives=t[""])}),t}function h(e){var t=[];if(!e)return t;do e.sticky&&t.push(e),e=e.parent;while(e);return t.reverse(),t}function p(e,t,n){if(e[n]===t[n])return{from:!1,to:!1};var r=n<e.length&&e[n].self.sticky,i=n<t.length&&t[n].self.sticky;return{from:r,to:i}}function d(e,t,n,r){if(r)return"updateStateParams";var i=u[e.self.name];if(!i)return"enter";if(e.self===n)return"updateStateParams";var s=m(t,i.locals.globals.$stateParams,e.ownParams);return s?"reactivate":"updateStateParams"}function v(e,t){var n=u[e.name];if(!n)return null;if(!t)return n;var r=m(t,n.locals.globals.$stateParams,e.ownParams);return r?n:null}function m(t,n,r){!e.isArray(r)&&e.isObject(r)&&(r=s(r,["$$keys","$$values","$$equals","$$validates","$$new","$$parent"]));if(!r){r=[];for(var i in t)r.push(i)}for(var o=0;o<r.length;o++){var u=r[o];if(t[u]!=n[u])return!1}return!0}var g={getInactiveStates:function(){var t=[];return e.forEach(u,function(e){t.push(e)}),t},getInactiveStatesByParent:function(){return c()},processTransition:function(t){var s={inactives:[],enter:[],exit:[],keep:0},u=t.fromState.path,a=t.fromParams,f=t.toState.path,l=t.toParams,h=t.reloadStateTree,v=t.options,g=0,y=f[g];v.inherit&&(l=i(r,l||{},n.$current,t.toState));while(y&&y===u[g]&&m(l,a,y.ownParams))y=f[++g];s.keep=g;var b,w,E,S={},x=p(u,f,g),T=!!v.reload;for(b=g;b<f.length;b++){var N=x.to?d(f[b],l,h,T):"enter";T=T||N=="updateStateParams",s.enter[b]=N,N=="reactivate"&&(E=S[f[b].name]=f[b]),N=="updateStateParams"&&(w=S[f[b].name]=f[b])}E=E?E.self.name+".":"",w=w?w.self.name+".":"";var C=c(),k=[""].concat(o(u.slice(0,g),function(e){return e.self.name}));e.forEach(k,function(e){var t=C[e];for(var n=0;t&&n<t.length;n++){var r=t[n];!S[r.name]&&(!E||r.self.name.indexOf(E)!==0)&&(!w||r.self.name.indexOf(w)!==0)&&s.inactives.push(r)}});for(b=g;b<u.length;b++){var L="exit";x.from&&(s.inactives.push(u[b]),L="inactivate"),s.exit[b]=L}return s},stateInactivated:function(e){u[e.self.name]=e,e.self.status="inactive",e.self.onInactivate&&a.invoke(e.self.onInactivate,e.self,e.locals.globals)},stateReactivated:function(e){u[e.self.name]&&delete u[e.self.name],e.self.status="entered",e.self.onReactivate&&a.invoke(e.self.onReactivate,e.self,e.locals.globals)},stateExiting:function(t,n,r){var i={};e.forEach(n,function(e){i[e.self.name]=!0}),e.forEach(u,function(n,r){!i[r]&&n.includes[t.name]&&(l&&f.debug("Exiting "+r+" because it's a substate of "+t.name+" and wasn't found in ",i),n.self.onExit&&a.invoke(n.self.onExit,n.self,n.locals.globals),e.forEach(n.locals,function(e,t){delete L.locals[t]}),n.locals=null,n.self.status="exited",delete u[r])}),r&&a.invoke(r,t.self,t.locals.globals),t.locals=null,t.self.status="exited",delete u[t.self.name]},stateEntering:function(e,t,n,r){var i=v(e);if(i&&(r||!v(e,t))){var s=e.locals;this.stateExiting(i),e.locals=s}e.self.status="entered",n&&a.invoke(n,e.self,e.locals.globals)},reset:function(r,i){var s=n.get(r),o=v(s,i);return o?(g.stateExiting(o),t.$broadcast("$viewContentLoading"),!0):!1}};return g}]}function O(e){return{resolve:{},locals:{globals:N&&N.locals&&N.locals.globals},views:{},self:{},params:{},ownParams:A.hasParamSet?{$$equals:function(){return!0}}:[],surrogateType:e}}var n=e.module("ct.ui.router.extras.core",["ui.router"]),r={},i=[];n.config(["$stateProvider","$injector",function(t,n){t.decorator("parent",function(t,n){return r[t.self.name]=t,t.self.$$state=function(){return r[t.self.name]},e.forEach(i,function(e){e(t)}),n(t)})}]);var s=!1,o=e.forEach,u=e.extend,a=e.isArray,f=function(e,t){var n=[];return o(e,function(e,r){n.push(t(e,r))}),n},l=function(e){return f(e,function(e,t){return t})},c=function(e,t){var n=[];return o(e,function(e,r){t(e,r)&&n.push(e)}),n},h=function(e,t){var n={};return o(e,function(e,r){t(e,r)&&(n[r]=e)}),n};n.provider("uirextras_core",function(){var t={internalStates:r,onStateRegistered:b,forEach:o,extend:u,isArray:a,map:f,keys:l,filter:c,filterObj:h,ancestors:p,objectKeys:d,protoKeys:v,arraySearch:m,inheritParams:g,inherit:y};e.extend(this,t),this.$get=function(){return t}});var w;e.module("ct.ui.router.extras.dsr",["ct.ui.router.extras.core"]).config(["$provide",function(e){var t;e.decorator("$state",["$delegate","$q",function(e,n){return t=e.transitionTo,e.transitionTo=function(r,i,s){return s.ignoreDsr&&(w=s.ignoreDsr),t.apply(e,arguments).then(function(e){return E(),e},function(e){return E(),n.reject(e)})},e}])}]),e.module("ct.ui.router.extras.dsr").service("$deepStateRedirect",["$rootScope","$state","$injector",function(n,r,i){function f(e){var t=e.name;if(o.hasOwnProperty(t))return o[t];c(t)}function l(t){var n=t.deepStateRedirect||t.dsr;if(!n)return{dsr:!1};var r={dsr:!0};return e.isFunction(n)?r.fn=n:e.isObject(n)&&(r=e.extend(r,n)),e.isString(r.default)&&(r.default={state:r.default}),r.fn||(r.fn=["$dsr$",function(e){return e.redirect.state!=e.to.state}]),r}function c(e){var n=r.get(e);if(!n)return!1;var i=l(n);i.dsr&&(o[n.name]=u,s[e]===t&&(s[e]={}));var f=n.$$state&&n.$$state().parent;if(f){var h=c(f.self.name);h&&o[n.name]===t&&(o[n.name]=a)}return o[n.name]||!1}function h(n,r){r===!0&&(r=Object.keys(n));if(r===null||r===t)r=[];var i={};return e.forEach(r.sort(),function(e){i[e]=n[e]}),i}function p(t,n){function i(e){return e?e.toString():e}var r=h(t,n),s={};return e.forEach(r,function(e,t){s[t]=i(e)}),e.toJson(s)}var s={},o={},u="Redirect",a="AncestorRedirect";return n.$on("$stateChangeStart",function(t,n,o,a,c){var d=l(n);if(w||f(n)!==u&&!d.default)return;var v=p(o,d.params),m=s[n.name][v]||d.default;if(!m)return;var g={redirect:{state:m.state,params:m.params},to:{state:n.name,params:o}},y=i.invoke(d.fn,n,{$dsr$:g});if(!y)return;y.state&&(m=y),t.preventDefault();var b=h(o,d.params);r.go(m.state,e.extend(b,m.params))}),n.$on("$stateChangeSuccess",function(t,n,i,o,u){var a=f(n);if(a){var c=n.name;e.forEach(s,function(t,n){var o=l(r.get(n)),u=p(i,o.params);if(c==n||c.indexOf(n+".")!=-1)s[n][u]={state:c,params:e.copy(i)}})}}),{reset:function(t,n){if(!t)e.forEach(s,function(e,t){s[t]={}});else{var i=r.get(t);if(!i)throw new Error("Unknown state: "+t);if(s[i.name])if(n){var o=p(n,l(i).params);delete s[i.name][o]}else s[i.name]={}}}}}]),e.module("ct.ui.router.extras.dsr").run(["$deepStateRedirect",function(e){}]),e.module("ct.ui.router.extras.sticky",["ct.ui.router.extras.core"]);var S=e.module("ct.ui.router.extras.sticky");x.$inject=["$stateProvider","uirextras_coreProvider"],S.provider("$stickyState",x);var T,r={},N,C=[],k,L,A={hasParamSet:!1};e.module("ct.ui.router.extras.sticky").run(["$stickyState",function(e){T=e}]),e.module("ct.ui.router.extras.sticky").config(["$provide","$stateProvider","$stickyStateProvider","$urlMatcherFactoryProvider","uirextras_coreProvider",function(n,r,i,s,o){function d(t,n,r){function i(e,t,n){return e[t]?e[t].toUpperCase()+": "+n.self.name:"("+n.self.name+")"}var s=c(r.inactives,function(e){return e.self.name}),o=c(n.toState.path,function(e,t){return i(r.enter,t,e)}),u=c(n.fromState.path,function(e,t){return i(r.exit,t,e)}),a=n.fromState.self.name+": "+e.toJson(n.fromParams)+": "+" -> "+n.toState.self.name+": "+e.toJson(n.toParams);t.debug("   Current transition: ",a),t.debug("Before transition, inactives are:   : ",c(T.getInactiveStates(),function(e){return e.self.name})),t.debug("After transition,  inactives will be: ",s),t.debug("Transition will exit:  ",u),t.debug("Transition will enter: ",o)}function v(e,t,n){e.debug("Current state: "+t.self.name+", inactive states: ",c(T.getInactiveStates(),function(e){return e.self.name}));var r=function(e,t){return"'"+t+"' ("+e.$$state.name+")"},i=function(e,t){return t!="globals"&&t!="resolve"},s=function(e){var t=c(h(e.locals,i),r).join(", ");return"("+(e.self.name?e.self.name:"root")+".locals"+(t.length?": "+t:"")+")"},o=s(t),u=t.parent;while(u&&u!==t)u.self.name===""&&(o=s(n.$current.path[0])+" / "+o),o=s(u)+" / "+o,t=u,u=t.parent;e.debug("Views: "+o)}var u=o,a=u.internalStates,f=u.inherit,l=u.inheritParams,c=u.map,h=u.filterObj;A.hasParamSet=!!s.ParamSet,L=e.extend(new O("__inactives"),{self:{name:"__inactives"}}),N=k=t,C=[],o.onStateRegistered(function(e){e.self.sticky===!0&&i.registerStickyState(e.self)});var p;n.decorator("$state",["$delegate","$log","$q",function(n,r,o){return N=n.$current,a[""]=N,N.parent=L,L.parent=t,N.locals=f(L.locals,N.locals),delete L.locals.globals,p=n.transitionTo,n.transitionTo=function(t,u,f){function H(t){var n=e.extend(new O("reactivate_phase1"),{locals:t.locals});return n.self=e.extend({},t.self),n}function B(t){var n=e.extend(new O("reactivate_phase2"),t),r=n.self.onEnter;return n.resolve={},n.views={},n.self.onEnter=function(){n.locals=t.locals,T.stateReactivated(t)},P.addRestoreFunction(function(){t.self.onEnter=r}),n}function j(e){var t=new O("inactivate");t.self=e.self;var n=e.self.onExit;return t.self.onExit=function(){T.stateInactivated(e)},P.addRestoreFunction(function(){e.self.onExit=n}),t}function F(e,t){var n=e.self.onEnter;return e.self.onEnter=function(){T.stateEntering(e,t,n)},P.addRestoreFunction(function(){e.self.onEnter=n}),e}function I(e,t){var n=e.self.onEnter;return e.self.onEnter=function(){T.stateEntering(e,t,n,!0)},P.addRestoreFunction(function(){e.self.onEnter=n}),e}function q(e){var t=e.self.onExit;return e.self.onExit=function(){T.stateExiting(e,M,t)},P.addRestoreFunction(function(){e.self.onExit=t}),e}var l=i.debugMode();L.locals||(L.locals=N.locals);var h=C.length;k&&(k(),l&&r.debug("Restored paths from pending transition"));var m=n.$current,g=n.params,y=f&&f.relative||n.$current,b=n.get(t,y),w,E,S,x=[],M=[],_;u=u||{},arguments[1]=u;var D=function(){},P=function(){w&&(R.path=w,w=null),E&&(m.path=E,E=null),e.forEach(P.restoreFunctions,function(e){e()}),P=D,k=null,C.splice(h,1)};P.restoreFunctions=[],P.addRestoreFunction=function(t){this.restoreFunctions.push(t)};if(b){var R=a[b.name];if(R){w=R.path,E=m.path;var U=f&&f.reload||!1,z=U&&(U===!0?w[0].self:n.get(U,y));f&&U&&U!==!0&&delete f.reload;var W={toState:R,toParams:u||{},fromState:m,fromParams:g||{},options:f,reloadStateTree:z};C.push(W),k=P;if(z){W.toParams.$$uirouterextrasreload=Math.random();var X=z.$$state().params,V=z.$$state().ownParams;if(A.hasParamSet){var $=new s.Param("$$uirouterextrasreload");X.$$uirouterextrasreload=V.$$uirouterextrasreload=$,P.restoreFunctions.push(function(){delete X.$$uirouterextrasreload,delete V.$$uirouterextrasreload})}else X.push("$$uirouterextrasreload"),V.push("$$uirouterextrasreload"),P.restoreFunctions.push(function(){X.length=X.length-1,V.length=V.length-1})}S=T.processTransition(W),l&&d(r,W,S);var J=R.path.slice(0,S.keep),K=m.path.slice(0,S.keep);e.forEach(L.locals,function(e,t){t.indexOf("@")!=-1&&delete L.locals[t]});for(var Q=0;Q<S.inactives.length;Q++){var G=S.inactives[Q].locals;e.forEach(G,function(e,t){G.hasOwnProperty(t)&&t.indexOf("@")!=-1&&(L.locals[t]=e)})}e.forEach(S.enter,function(e,t){var n,r=R.path[t];e==="reactivate"?(n=H(r),J.push(n),K.push(n),x.push(B(r)),_=r):e==="updateStateParams"?(n=I(r),J.push(n),_=r):e==="enter"&&J.push(F(r))}),e.forEach(S.exit,function(e,t){var n=m.path[t];e==="inactivate"?(K.push(j(n)),M.push(n)):e==="exit"&&(K.push(q(n)),M.push(n))}),x.length&&e.forEach(x,function(e){J.push(e)});if(R===_){var Y=_.self.name+".",Z=T.getInactiveStates(),et=[];Z.forEach(function(e){e.self.name.indexOf(Y)===0&&et.push(e)}),et.sort(),et.reverse(),K=K.concat(c(et,function(e){return q(e)})),M=M.concat(et)}R.path=J,m.path=K;var tt=function(e){return(e.surrogateType?e.surrogateType+":":"")+e.self.name};l&&r.debug("SurrogateFromPath: ",c(K,tt)),l&&r.debug("SurrogateToPath:   ",c(J,tt))}}var nt=p.apply(n,arguments);return nt.then(function(t){return P(),l&&v(r,a[t.name],n),t.status="active",t},function(t){return P(),l&&t.message!=="transition prevented"&&t.message!=="transition aborted"&&t.message!=="transition superseded"&&(r.debug("transition failed",t),console.log(t.stack)),o.reject(t)})},n}])}]),function(e,t){function r(t,n,r,i){function d(t,n){var r=e.isObject(t)?t.name:t;return n?a[r]:o[r]}function v(e,t){if(t.name){var n=t.name.split(/\./);t.name.charAt(0)==="."&&(n[0]=e.current.name);while(n.length){var r=n.join(".");if(e.get(r,{relative:e.current}))return null;if(a[r])return a[r];n.pop()}}if(t.url){var i=[];for(var s in a){var o=a[s].urlMatcher;o&&o.exec(t.url)&&i.push(a[s])}var u=i.slice(0);for(var f=i.length-1;f>=0;f--)for(var l=0;l<u.length;l++)i[f]===u[l].parentFutureState&&i.splice(f,1);return i[0]}}function m(e,t){f=!0;var n=e.get("$q");if(!t){var r=n.defer();return r.reject("No lazyState passed in "+t),r.promise}var i=n.when([]),s=t.parentFutureState;s&&a[s.name]&&(i=m(e,a[s.name]));var o=t.type,l=u[o];if(!l)throw Error("No state factory for futureState.type: "+(t&&t.type));return i.then(function(n){var r=e.invoke(l,l,{futureState:t});return r.then(function(e){return e&&n.push(e),n})})["finally"](function(){delete a[t.name]})}function y(e,n){var r=!1,i=["$rootScope","$urlRouter","$state",function(s,o,u){function a(){r=!0,o.sync(),r=!1}if(!h){c().then(a),h=!0;return}var l=v(u,{url:n.path()});if(!l)return e.invoke(g);m(e,l).then(function(n){n.forEach(function(e){e&&(!u.get(e)||e.name&&!u.get(e.name))&&t.state(e)}),f=!1,a()},function(){f=!1,a()})}];if(f)return;var s=r?g:i;return e.invoke(s)}var s=i,o=s.internalStates,u={},a={},f=!1,l=[],c,h=!1,p=this;this.addResolve=function(e){l.push(e)},this.stateFactory=function(e,t){u[e]=t},this.futureState=function(t){t.stateName&&(t.name=t.stateName),t.urlPrefix&&(t.url="^"+t.urlPrefix),a[t.name]=t;var n,i=t.name.split(/\./).slice(0,-1).join("."),s=d(t.parent||i);if(s)n=s.url||s.navigable.url;else if(i==="")n=r.compile("");else{var o=d(t.parent||i,!0);if(!o)throw new Error("Couldn't determine parent state of future state. FutureState:"+e.toJson(t));var u=o.urlMatcher.source.replace(/\*rest$/,"");n=r.compile(u),t.parentFutureState=o}t.url&&(t.urlMatcher=t.url.charAt(0)==="^"?r.compile(t.url.substring(1)+"*rest"):n.concat(t.url+"*rest"))},this.get=function(){return e.extend({},a)};var g=["$log","$location",function(t,n){t.debug("Unable to map "+n.path())}];n.otherwise(y),n.otherwise=function(t){if(e.isString(t)){var r=t;t=function(){return r}}else if(!e.isFunction(t))throw new Error("'rule' must be a function");return g=["$injector","$location",t],n};var b={getResolvePromise:function(){return c()}};this.$get=["$injector","$state","$q","$rootScope","$urlRouter","$timeout","$log",function(r,i,s,o,u,a,h){function d(){o.$on("$stateNotFound",function(n,s,o,u){if(f)return;h.debug("event, unfoundState, fromState, fromParams",n,s,o,u);var a=v(i,{name:s.to});if(!a)return;n.preventDefault();var l=m(r,a);l.then(function(e){e.forEach(function(e){e&&(!i.get(e)||e.name&&!i.get(e.name))&&t.state(e)}),i.go(s.to,s.toParams),f=!1},function(e){console.log("failed to lazy load state ",e),i.go(o,u),f=!1})});if(!c){var n=[];e.forEach(l,function(e){n.push(r.invoke(e))}),c=function(){return s.all(n)}}c().then(function(){a(function(){i.transition?i.transition.then(u.sync,u.sync):u.sync()})})}return d(),b.state=t.state,b.futureState=p.futureState,b.get=p.get,b}]}var n=e.module("ct.ui.router.extras.future",["ct.ui.router.extras.core"]);r.$inject=["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","uirextras_coreProvider"],n.provider("$futureState",r);var i={state:function(e){i.$rootScope&&i.$rootScope.$broadcast("$stateAdded",e)},itsNowRuntimeOhWhatAHappyDay:function(e){i.$rootScope=e},$rootScope:t};n.config(["$stateProvider",function(t){var n=t.state;t.state=function(){var s=n.apply(t,arguments),o=e.isObject(arguments[0])?arguments[0]:arguments[1];return i.state(o),s}}]),n.run(["$futureState",function(e,t){i.itsNowRuntimeOhWhatAHappyDay(t)}])}(e),e.module("ct.ui.router.extras.previous",["ct.ui.router.extras.core","ct.ui.router.extras.transition"]).service("$previousState",["$rootScope","$state",function(e,n){var r=null,i=null,s={};e.$on("$transitionStart",function(e,t){function o(){i=null}function u(){r=i}var n=t.from,s=n.state&&n.state.$$state&&n.state.$$state();s&&s.navigable&&(i=r,r=t.from),t.promise.then(o).catch(u)});var o={get:function(e){return e?s[e]:r},go:function(e,t){var r=o.get(e);return n.go(r.state,r.params,t)},memo:function(e,t,i){s[e]=r||{state:n.get(t),params:i}},forget:function(e){e?delete s[e]:r=t}};return o}]),e.module("ct.ui.router.extras.previous").run(["$previousState",function(e){}]),e.module("ct.ui.router.extras.transition",["ct.ui.router.extras.core"]).config(["$provide",function(t){t.decorator("$state",["$delegate","$rootScope","$q","$injector",function(t,n,r,i){function f(t){var n=i.invoke,r=i.instantiate;return i.invoke=function(r,i,s){return n(r,i,e.extend({$transition$:t},s))},i.instantiate=function(n,i){return r(n,e.extend({$transition$:t},i))},function(){i.invoke=n,i.instantiate=r}}function l(){a.pop()(),u.pop(),o--}function c(e,t){return function(i){return l(),n.$broadcast("$transitionSuccess",t),e.resolve(i),i}}function h(e,t){return function(s){return l(),n.$broadcast("$transitionError",t,s),e.reject(s),r.reject(s)}}var s=t.transitionTo,o=-1,u=[],a=[];return t.transitionTo=function(e,n,i){var f=r.defer(),l=u[++o]={promise:f.promise};a[o]=function(){};var p=s.apply(t,arguments);return p.then(c(f,l),h(f,l))},n.$on("$stateChangeStart",function(t,r,i,s,l){var c=o,h=e.extend(u[c],{to:{state:r,params:i},from:{state:s,params:l}}),p=f(h);a[c]=p,n.$broadcast("$transitionStart",h)}),t}])}]),function(){function n(t,n,r){return{scope:{width:"@",height:"@"},restrict:"AE",template:"<svg></svg>",link:function(n,i,s){function E(t){t=t.map(function(t){return t.name===""?l:e.copy(t)}),e.extend(o,t.reduce(function(e,t){return e[t.name]=t,e},{})),t.forEach(function(e){var t=e.name.split(/\./).slice(0,-1).join("."),n=e.name!=t&&o[t];n&&((n.children||(n.children=[])).push(e),e.px=n.px,e.py=n.py,c.push(e))})}function S(){function t(e){var t=e.name.split(".").pop();return e.sticky&&(t+=" (STICKY)"),e.deepStateRedirect&&(t+=" (DSR)"),t}v=v.data(f.nodes(l),function(e){return e.name}),m=m.data(f.links(c),function(e){return e.target.name}),g=g.data(h),c.forEach(function(e){e.y=e.depth*70});var e=v.enter();g.enter().append("circle").attr("class","active").attr("r",13).attr("cx",function(e){return e.parent.px||100}).attr("cy",function(e){return e.parent.py||100}),e.append("circle").attr("class","node").attr("r",9).attr("cx",function(e){return e.parent.px}).attr("cy",function(e){return e.parent.py}),e.append("text").attr("class","label").attr("x",function(e){return e.parent.px}).attr("y",function(e){return e.parent.py}).attr("text-anchor",function(e){return"middle"}).text(t).style("fill-opacity",1),m.enter().insert("path",".node").attr("class","link").attr("d",function(e){var t={x:e.source.px,y:e.source.py};return p({source:t,target:t})});var n=d.transition().duration(b);n.selectAll(".link").attr("d",p);var r={entered:"#AF0",exited:"#777",active:"#0f0",inactive:"#55F",future:"#009"};n.selectAll(".node").attr("cx",function(e){return e.px=e.x}).attr("cy",function(e){return e.py=e.y}).attr("r",function(e){return e.status==="active"?15:10}).style("fill",function(e){return r[e.status]||"#FFF"}),n.selectAll(".label").attr("x",function(e){return e.px=e.x}).attr("y",function(e){return e.py=e.y-15}).attr("transform",function(e){return"rotate(-25 "+e.x+" "+e.y+")"}),n.selectAll(".active").attr("x",function(e){return e.px=e.x}).attr("y",function(e){return e.py=e.y-15})}var o={},u=n.width||400,a=n.height||400,f=d3.layout.tree().size([u-20,a-20]).separation(function(e,t){return e.parent==t.parent?10:25}),l=t.get().filter(function(e){return e.name===""})[0],c=f(l);l.parent=l,l.px=l.x=u/2,l.py=l.y=a/2;var h={};h.px=h.x=l.px,h.py=h.y=l.py;var p=d3.svg.diagonal(),d=d3.select(i.find("svg")[0]).attr("width",u).attr("height",a).append("g").attr("transform","translate(10, 10)"),v=d.selectAll(".node"),m=d.selectAll(".link"),g=d.selectAll(".active"),y=200,b=200,w=setInterval(S,y);r(function(){n.states=t.get(),e.forEach(c,function(e){var n=t.get(e.name);n&&(e.status=n.status||"exited")})},250),n.$watchCollection("states",function(e,t){var n=(t||[]).map(function(e){return e.name});E((e||[]).filter(function(e){return n.indexOf(e.name)==-1}))}),S(y)}}}var t=e.module("ct.ui.router.extras.statevis",["ct.ui.router.extras.core","ct.ui.router.extras.sticky"]);t.directive("stateVis",["$state","$timeout","$interval",n])}(),e.module("ct.ui.router.extras",["ct.ui.router.extras.core","ct.ui.router.extras.dsr","ct.ui.router.extras.future","ct.ui.router.extras.previous","ct.ui.router.extras.statevis","ct.ui.router.extras.sticky","ct.ui.router.extras.transition"])})(angular)