/* ========================================================================
 * Ratchet: push.js v2.0.2
 * http://goratchet.com/components#push
 * ========================================================================
 * inspired by @defunkt's jquery.pjax.js
 * Copyright 2014 Connor Sears
 * Licensed under MIT (https://github.com/twbs/ratchet/blob/master/LICENSE)
 * ======================================================================== */

!function(){var e=function(){},t,n=20,r=sessionStorage,i={},s={slideIn:"slide-out",slideOut:"slide-in",fade:"fade"},o={bartab:".bar-tab",barnav:".bar-nav",barfooter:".bar-footer",barheadersecondary:".bar-header-secondary"},u=function(e,t){d.id=e.id,t&&(e=l(e.id)),r[e.id]=JSON.stringify(e),window.history.replaceState(e.id,e.title,e.url),i[e.id]=document.body.cloneNode(!0)},a=function(){var e=d.id,t=JSON.parse(r.cacheForwardStack||"[]"),i=JSON.parse(r.cacheBackStack||"[]");i.push(e);while(t.length)delete r[t.shift()];while(i.length>n)delete r[i.shift()];window.history.pushState(null,"",r[d.id].url),r.cacheForwardStack=JSON.stringify(t),r.cacheBackStack=JSON.stringify(i)},f=function(e,t){var n=t==="forward",i=JSON.parse(r.cacheForwardStack||"[]"),s=JSON.parse(r.cacheBackStack||"[]"),o=n?s:i,u=n?i:s;d.id&&o.push(d.id),u.pop(),r.cacheForwardStack=JSON.stringify(i),r.cacheBackStack=JSON.stringify(s)},l=function(e){return JSON.parse(r[e]||null)||{}},c=function(e){var n=b(e.target);if(!n||e.which>1||e.metaKey||e.ctrlKey||t||location.protocol!==n.protocol||location.host!==n.host||!n.hash&&/#/.test(n.href)||n.hash&&n.href.replace(n.hash,"")===location.href.replace(location.hash,"")||n.getAttribute("data-ignore")==="push")return;return n},h=function(e){var t=c(e);if(!t)return;e.preventDefault(),d({url:t.href,hash:t.hash,timeout:t.getAttribute("data-timeout"),transition:t.getAttribute("data-transition")})},p=function(e){var t,n,u,a,c,h,p,v,m=e.state;if(!m||!r[m])return;c=d.id<m?"forward":"back",f(m,c),u=l(m),a=i[m],u.title&&(document.title=u.title),c==="back"?(p=JSON.parse(c==="back"?r.cacheForwardStack:r.cacheBackStack),v=l(p[p.length-1])):v=u;if(c==="back"&&!v.id)return d.id=m;h=c==="back"?s[v.transition]:v.transition;if(!a)return d({id:u.id,url:u.url,title:u.title,timeout:u.timeout,transition:h,ignorePush:!0});if(v.transition){u=E(u,".content",a.cloneNode(!0));for(t in o)o.hasOwnProperty(t)&&(n=document.querySelector(o[t]),u[t]?g(u[t],n):n&&n.parentNode.removeChild(n))}g((u.contents||a).cloneNode(!0),document.querySelector(".content"),h),d.id=m,document.body.offsetHeight},d=function(t){var n,r=d.xhr;t.container=t.container||t.transition?document.querySelector(".content"):document.body;for(n in o)o.hasOwnProperty(n)&&(t[n]=t[n]||document.querySelector(o[n]));r&&r.readyState<4&&(r.onreadystatechange=e,r.abort()),r=new XMLHttpRequest,r.open("GET",t.url,!0),r.setRequestHeader("X-PUSH","true"),r.onreadystatechange=function(){t._timeout&&clearTimeout(t._timeout),r.readyState===4&&(r.status===200?v(r,t):m(t.url))},d.id||u({id:+(new Date),url:window.location.href,title:document.title,timeout:t.timeout,transition:null}),t.timeout&&(t._timeout=setTimeout(function(){r.abort("timeout")},t.timeout)),r.send(),r.readyState&&!t.ignorePush&&a()},v=function(e,t){var n,r,i=S(e,t);if(!i.contents)return w(t.url);i.title&&(document.title=i.title);if(t.transition)for(n in o)o.hasOwnProperty(n)&&(r=document.querySelector(o[n]),i[n]?g(i[n],r):r&&r.parentNode.removeChild(r));g(i.contents,t.container,t.transition,function(){u({id:t.id||+(new Date),url:i.url,title:i.title,timeout:t.timeout,transition:t.transition},t.id),y()}),!t.ignorePush&&window._gaq&&_gaq.push(["_trackPageview"]);if(!t.hash)return},m=function(e){throw new Error("Could not get: "+e)},g=function(e,t,n,r){var i,s,o;n?(i=/in$/.test(n),n==="fade"&&(t.classList.add("in"),t.classList.add("fade"),e.classList.add("fade")),/slide/.test(n)&&(e.classList.add("sliding-in",i?"right":"left"),e.classList.add("sliding"),t.classList.add("sliding")),t.parentNode.insertBefore(e,t)):t?t.innerHTML=e.innerHTML:e.classList.contains("content")?document.body.appendChild(e):document.body.insertBefore(e,document.querySelector(".content")),n||r&&r();if(n==="fade"){t.offsetWidth,t.classList.remove("in");var u=function(){t.removeEventListener("webkitTransitionEnd",u),e.classList.add("in"),e.addEventListener("webkitTransitionEnd",a)},a=function(){e.removeEventListener("webkitTransitionEnd",a),t.parentNode.removeChild(t),e.classList.remove("fade"),e.classList.remove("in"),r&&r()};t.addEventListener("webkitTransitionEnd",u)}if(/slide/.test(n)){var f=function(){e.removeEventListener("webkitTransitionEnd",f),e.classList.remove("sliding","sliding-in"),e.classList.remove(o),t.parentNode.removeChild(t),r&&r()};t.offsetWidth,o=i?"right":"left",s=i?"left":"right",t.classList.add(s),e.classList.remove(o),e.addEventListener("webkitTransitionEnd",f)}},y=function(){var e=new CustomEvent("push",{detail:{state:l(d.id)},bubbles:!0,cancelable:!0});window.dispatchEvent(e)},b=function(e){var t,n=document.querySelectorAll("a");for(;e&&e!==document;e=e.parentNode)for(t=n.length;t--;)if(n[t]===e)return e},w=function(e){window.history.replaceState(null,"","#"),window.location.replace(e)},E=function(e,t,n){var r,i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);return Object.keys(o).forEach(function(e){var t=n.querySelector(o[e]);t&&t.parentNode.removeChild(t),i[e]=t}),i.contents=n.querySelector(t),i},S=function(e,t){var n,r,i={},s=e.responseText;i.url=t.url;if(!s)return i;/<html/i.test(s)?(n=document.createElement("div"),r=document.createElement("div"),n.innerHTML=s.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0],r.innerHTML=s.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]):(n=r=document.createElement("div"),n.innerHTML=s),i.title=n.querySelector("title");var o="innerText"in i.title?"innerText":"textContent";return i.title=i.title&&i.title[o].trim(),t.transition?i=E(i,".content",r):i.contents=r,i};window.addEventListener("touchstart",function(){t=!1}),window.addEventListener("touchmove",function(){t=!0}),window.addEventListener("touchend",h),window.addEventListener("click",function(e){c(e)&&e.preventDefault()}),window.addEventListener("popstate",p),window.PUSH=d}()